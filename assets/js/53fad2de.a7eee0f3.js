"use strict";(self.webpackChunkceobe_canteen_blog=self.webpackChunkceobe_canteen_blog||[]).push([[617],{9613:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(9496);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=a.createContext({}),u=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(d.Provider,{value:n},e.children)},p="mdxType",s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(t),m=o,k=p["".concat(d,".").concat(m)]||p[m]||s[m]||r;return t?a.createElement(k,l(l({ref:n},c),{},{components:t})):a.createElement(k,l({ref:n},c))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=m;var i={};for(var d in n)hasOwnProperty.call(n,d)&&(i[d]=n[d]);i.originalType=e,i[p]="string"==typeof e?e:o,l[1]=i;for(var u=2;u<r;u++)l[u]=t[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7036:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>s,frontMatter:()=>r,metadata:()=>i,toc:()=>u});var a=t(7366),o=(t(9496),t(9613));const r={slug:"\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",title:"\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",authors:"endi",tags:["Typescript","Vue"]},l=void 0,i={permalink:"/Ceobe-Canteen-Blog/blog/\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",editUrl:"https://github.com/Enraged-Dun-Cookie-Development-Team/Ceobe-Canteen-Blog/blob/main/blog/2023-07-07-font-end-voice-record.md",source:"@site/blog/2023-07-07-font-end-voice-record.md",title:"\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",description:"\u7531\u4e8e\u67d0\u4e9b\u9700\u8981\uff0c\u6211\u9700\u8981\u5728\u524d\u7aef\u9875\u9762\u8fdb\u884c\u5f55\u97f3\uff0c\u5e76\u4f20\u9012\u5230\u540e\u7aef\u3002\u4f7f\u7528\u524d\u7aef\u8fdb\u884c\u97f3\u9891\u5f55\u5236\u65f6\uff0c\u4f1a\u6709\u4e00\u5b9a\u7684\u6ce8\u610f\u4e8b\u9879\uff0c\u56e0\u6b64\u5728\u7b80\u8981\u4ecb\u7ecd\u4f7f\u7528\u524d\u7aef\u5f55\u97f3\u7684\u5927\u6982\u6d41\u7a0b\uff0c\u5e76\u7b80\u8981\u4ecb\u7ecd\u9700\u8981\u6ce8\u610f\u7684\u8981\u70b9\u3002",date:"2023-07-07T00:00:00.000Z",formattedDate:"2023\u5e747\u67087\u65e5",tags:[{label:"Typescript",permalink:"/Ceobe-Canteen-Blog/blog/tags/typescript"},{label:"Vue",permalink:"/Ceobe-Canteen-Blog/blog/tags/vue"}],readingTime:10.385,hasTruncateMarker:!1,authors:[{name:"\u51ca\u5f26\u51dd\u7edd",title:"\u5c0f\u523b\u98df\u5802\u540e\u7aef",url:"https://github.com/GoodJooy",imageURL:"https://github.com/Goodjooy.png",key:"endi"}],frontMatter:{slug:"\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",title:"\u524d\u7aef\u5f55\u97f3\u5f00\u53d1",authors:"endi",tags:["Typescript","Vue"]},nextItem:{title:"\u4efb\u52a1\u7528\u65f6\u8bb0\u5f55\uff08TimeUsageRecordFuture\uff09",permalink:"/Ceobe-Canteen-Blog/blog/\u4efb\u52a1\u7528\u65f6\u8bb0\u5f55\uff08TimeUsageRecordFuture\uff09"}},d={authorsImageUrls:[void 0]},u=[{value:"\u5728\u6d4f\u89c8\u5668\u4e0a\u53d6\u5f97\u9ea6\u514b\u98ce\u6743\u9650\u76f8\u5173\u63a5\u53e3:<code>MediaRecorder</code>",id:"\u5728\u6d4f\u89c8\u5668\u4e0a\u53d6\u5f97\u9ea6\u514b\u98ce\u6743\u9650\u76f8\u5173\u63a5\u53e3mediarecorder",level:2},{value:"\u7533\u8bf7\u6743\u9650\u5e76\u5f55\u97f3",id:"\u7533\u8bf7\u6743\u9650\u5e76\u5f55\u97f3",level:2},{value:"Edge: \u5f55\u97f3\u7ed3\u679c\u4e0d\u542b\u6709\u97f3\u9891\u957f\u5ea6\u4fe1\u606f",id:"edge-\u5f55\u97f3\u7ed3\u679c\u4e0d\u542b\u6709\u97f3\u9891\u957f\u5ea6\u4fe1\u606f",level:2},{value:"FireFox &amp; Edge \u5f53\u4f7f\u7528 HTTP \u534f\u8bae\u5e76\u4e14\u670d\u52a1\u5668 IP \u4e0d\u662f\u672c\u5730\u56de\u73af\u65f6\uff0c\u5a92\u4f53\u8d44\u6e90\u4e0d\u53ef\u7528",id:"firefox--edge-\u5f53\u4f7f\u7528-http-\u534f\u8bae\u5e76\u4e14\u670d\u52a1\u5668-ip-\u4e0d\u662f\u672c\u5730\u56de\u73af\u65f6\u5a92\u4f53\u8d44\u6e90\u4e0d\u53ef\u7528",level:2},{value:"FireFox",id:"firefox",level:3},{value:"Edge",id:"edge",level:3},{value:"\u5b8c\u6574\u4ee3\u7801",id:"\u5b8c\u6574\u4ee3\u7801",level:2}],c={toc:u},p="wrapper";function s(e){let{components:n,...t}=e;return(0,o.kt)(p,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u7531\u4e8e\u67d0\u4e9b\u9700\u8981\uff0c\u6211\u9700\u8981\u5728\u524d\u7aef\u9875\u9762\u8fdb\u884c\u5f55\u97f3\uff0c\u5e76\u4f20\u9012\u5230\u540e\u7aef\u3002\u4f7f\u7528\u524d\u7aef\u8fdb\u884c\u97f3\u9891\u5f55\u5236\u65f6\uff0c\u4f1a\u6709\u4e00\u5b9a\u7684\u6ce8\u610f\u4e8b\u9879\uff0c\u56e0\u6b64\u5728\u7b80\u8981\u4ecb\u7ecd\u4f7f\u7528\u524d\u7aef\u5f55\u97f3\u7684\u5927\u6982\u6d41\u7a0b\uff0c\u5e76\u7b80\u8981\u4ecb\u7ecd\u9700\u8981\u6ce8\u610f\u7684\u8981\u70b9\u3002"),(0,o.kt)("h2",{id:"\u5728\u6d4f\u89c8\u5668\u4e0a\u53d6\u5f97\u9ea6\u514b\u98ce\u6743\u9650\u76f8\u5173\u63a5\u53e3mediarecorder"},"\u5728\u6d4f\u89c8\u5668\u4e0a\u53d6\u5f97\u9ea6\u514b\u98ce\u6743\u9650\u76f8\u5173\u63a5\u53e3:",(0,o.kt)("inlineCode",{parentName:"h2"},"MediaRecorder")),(0,o.kt)("p",null,"\u5176\u5b9e\uff0c\u4e0e\u5f88\u591a\u4eba\u8ba4\u77e5\u4e2d\u7684\u4e0d\u540c\uff0c\u6d4f\u89c8\u5668\u5176\u5b9e\u80fd\u63d0\u4f9b\u76f8\u5f53\u4e30\u5bcc\u7684\u591a\u5a92\u4f53\u8f93\u5165\u8d44\u6e90\u3002\u4f46\u662f\u4e0e\u5b89\u88c5\u5728\u8bbe\u5907\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u540c\uff0c\u6bcf\u6b21\u4f7f\u7528\u8fd9\u4e9b\u591a\u5a92\u4f53\u8bbe\u5907\uff0c\u9700\u8981\u8fdb\u884c\u6743\u9650\u7533\u8bf7\u5e76\u5f97\u5230\u7528\u6237\u6388\u6743\uff0c\u5426\u5219\u5c06\u65e0\u6cd5\u4f7f\u7528\u90a3\u4e9b\u63a5\u53e3\u3002\u540c\u65f6\uff0c\u6d4f\u89c8\u5668\u7684\u5b89\u5168\u7b56\u7565\u540c\u6837\u4e5f\u53ef\u80fd\u4f1a\u4f7f\u5f97\u67d0\u4e9b\u770b\u4f3c\u53ef\u7528\u7684\u529f\u80fd\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u53ef\u7528\u3002"),(0,o.kt)("p",null,"\u5728\u8fd9\u91cc\uff0c\u6211\u4f7f\u7528\u539f\u751f\u7684 ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder"},(0,o.kt)("inlineCode",{parentName:"a"},"MediaRecorder"))," \u8fdb\u884c\u97f3\u9891\u5f55\u5236\u3002\u4f46\u662f\u89c2\u5bdf\u5176",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder/MediaRecorder"},"\u6784\u9020\u51fd\u6570"),"\uff0c\u4f1a\u6ce8\u610f\u5230, \u9700\u8981\u4e00\u4e2a\u5fc5\u9009\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"stream")," \u53c2\u6570\uff0c\u8fd9\u4e2a\u5c31\u662f\u5c06\u8981\u7528\u4e8e\u5f55\u5236\u7684\u6d41\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u6d41\uff0c\u6709\u591a\u79cd\u53d6\u5f97\u65b9\u5f0f"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia"},(0,o.kt)("inlineCode",{parentName:"a"},"navigator.mediaDevices.getUserMedia()"))," \u8fd9\u4e2a\u63a5\u53e3\u4f1a\u8fd4\u56de\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"Promise"),",\u7b49\u5f85\u7528\u6237\u786e\u8ba4\u6743\u9650\u7533\u8bf7\uff0c\u5e76\u53d6\u5f97\u8bf7\u6c42\u7684",(0,o.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStream"},(0,o.kt)("inlineCode",{parentName:"a"},"MediaStream")),", \u8fd9\u4e2a",(0,o.kt)("inlineCode",{parentName:"li"},"MediaStream"),"\u53ef\u4ee5\u4f5c\u4e3a",(0,o.kt)("inlineCode",{parentName:"li"},"MediaRecorder"),"\u7684\u6784\u9020\u51fd\u6570\u4e2d\u7684",(0,o.kt)("inlineCode",{parentName:"li"},"stream")),(0,o.kt)("li",{parentName:"ol"},"DOM \u5143\u7d20 ",(0,o.kt)("inlineCode",{parentName:"li"},"<canvas>"),"\u3001",(0,o.kt)("inlineCode",{parentName:"li"},"<audio>")," \u548c ",(0,o.kt)("inlineCode",{parentName:"li"},"<vedio>"))),(0,o.kt)("p",null,"\u800c\u5f53 ",(0,o.kt)("inlineCode",{parentName:"p"},"MediaRecorder")," \u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u6bd4\u8f83\u5bb9\u6613\u4e86\u3002 \u53ef\u4ee5\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"start()")," \u5f00\u59cb\u97f3\u9891\u5f55\u5236\uff0c\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"stop()")," \u505c\u6b62\u97f3\u9891\u5f55\u5236\uff0c\u7136\u540e\u63d0\u4f9b\u4e8b\u4ef6 ",(0,o.kt)("inlineCode",{parentName:"p"},"ondataavailable"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"onstop"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"onstart")," \u7b49\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\uff0c\u770b\u8d77\u6765\u4f3c\u4e4e\u4e00\u5207\u5176\u5b9e\u5e76\u4e0d\u590d\u6742\u3002"),(0,o.kt)("h2",{id:"\u7533\u8bf7\u6743\u9650\u5e76\u5f55\u97f3"},"\u7533\u8bf7\u6743\u9650\u5e76\u5f55\u97f3"),(0,o.kt)("p",null,"\u5728\u8fd9\u91cc\uff0c\u4f7f\u7528 vue + vuetify \u4f5c\u4e3a\u6846\u67b6\uff0c\u4ee5\u80fd\u63d0\u4f9b\u6613\u4e8e\u5236\u4f5c\u7684\u524d\u7aef\u9875\u9762\u3002\u540c\u65f6\u4f7f\u7528 typescript \u7f16\u5199\uff0c\u4ee5\u4fdd\u8bc1\u80fd\u8fd1\u4f3c\u5f97\u5230\u5f3a\u7c7b\u578b\u8bed\u8a00\u7684\u652f\u6301\u548c\u5b89\u5168\u611f\u3002"),(0,o.kt)("p",null,"\u6211\u4f7f\u7528\u7684\u662f Vue \u7684\u7ec4\u5408\u5f0f API, \u5176\u4e2d",(0,o.kt)("inlineCode",{parentName:"p"},"<template>"),"\u90e8\u5206\u5982\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div>\n  <v-container justify="center">\n    <v-col sm="6" md="4" cols="auto">\n      <v-btn @click="onQueryPermission">Request Audio Permission</v-btn>\n    </v-col>\n    <v-col sm="6" md="4" cols="auto">\n      <v-btn v-if="mediaRecorder != null" @click="onRecordSwitch"\n        >{{ inRecording ? "Stop" : "Start" }} Audio Recording</v-btn\n      >\n    </v-col>\n    <audio v-if="audioURL != null" controls :src="audioURL"></audio>\n  </v-container>\n</div>\n')),(0,o.kt)("p",null,"\u5176\u4e2d\uff0c\u5305\u542b 2 \u4e2a\u6309\u94ae\u548c 1 \u4e2a\u97f3\u9891\u64ad\u653e\u5668\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u4e2a\u6309\u94ae ",(0,o.kt)("inlineCode",{parentName:"li"},"Request Audio Permission")," \u7528\u4e8e\u7533\u8bf7\u9ea6\u514b\u98ce\u6743\u9650"),(0,o.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u4e2a\u6309\u94ae ",(0,o.kt)("inlineCode",{parentName:"li"},"Stop/Start Audio Recording")," \u7528\u4e8e\u6267\u884c\u5f55\u97f3\u7684\u5f00\u59cb\u548c\u505c\u6b62"),(0,o.kt)("li",{parentName:"ul"},"\u7b2c\u4e09\u4e2a\u64ad\u653e\u5668\u7528\u4e8e\u64ad\u653e\u521a\u521a\u5f55\u5236\u7684\u97f3\u9891\u5185\u5bb9")),(0,o.kt)("p",null,"\u5bf9\u4e8e\u4ee5\u4e0a\u7684 template \u9700\u8981\u90e8\u5206\u72b6\u6001\u4fdd\u6301\uff0c\u5982\u4ee5\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'import { ref } from "vue";\n\n// \u5728\u672a\u53d6\u5f97\u7528\u6237\u6388\u6743\uff0c\u6ca1\u6709\u76f8\u5e94\u7684\u5f55\u97f3\u5668\u5b9e\u4f8b\u5b58\u5728\nconst mediaRecorder = ref<null | MediaRecorder>(null);\n// \u5f53\u524d\u662f\u5426\u6b63\u5728\u8fdb\u884c\u5f55\u97f3\nconst inRecording = ref(false);\n// \u5f55\u97f3\u7ed3\u679c\u7684URL\nconst audioURL = ref<null | string>(null);\n// \u5f55\u97f3\u7ed3\u679c\u7684\u539f\u59cbBlob\nconst audioBlob = ref<null | Blob>(null);\n')),(0,o.kt)("p",null,"\u6700\u540e\u5c31\u662f\u5404\u4e2a\u6309\u952e\u7684\u56de\u8c03\u51fd\u6570\u90e8\u5206"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onQueryPermission")," \u5411\u7528\u6237\u53d1\u8d77\u9ea6\u514b\u98ce\u6743\u9650\u8bf7\u6c42\u3002\u5982\u679c\u7528\u6237\u8bb8\u53ef\uff0c\u90a3\u5c31\u521b\u5efa\u4e00\u4e2a",(0,o.kt)("inlineCode",{parentName:"li"},"MediaRecorder")," \u5b9e\u4f8b\uff0c\u4ee5\u4f9b\u540e\u7eed\u4f7f\u7528\u3002\u5b9e\u73b0\u4e3b\u8981\u662f\u4e3a",(0,o.kt)("inlineCode",{parentName:"li"},"MediaRecorder"),"\u5b9e\u4f8b\u6dfb\u52a0 ",(0,o.kt)("inlineCode",{parentName:"li"},"ondataavailable"),"\u4e8b\u4ef6\u56de\u8c03\u3002\u5728\u8fd9\u4e2a\u56de\u8c03\u4e2d\uff0c\u9700\u8981\u53d6\u5f97\u5f55\u97f3\u97f3\u9891\u672c\u4f53",(0,o.kt)("inlineCode",{parentName:"li"},"Blob")," \u7136\u540e\u8f6c\u6362\u4e3a",(0,o.kt)("inlineCode",{parentName:"li"},"audio/ogg")," \u683c\u5f0f\uff0c\u6700\u540e\u751f\u6210 ",(0,o.kt)("inlineCode",{parentName:"li"},"audioURL")," \u4f9b\u64ad\u653e\u5668\u4f7f\u7528")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'const onQueryPermission = () => {\n  navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n    let recorder = new MediaRecorder(stream);\n    recorder.ondataavailable = (ev) => {\n      const blob = new Blob([ev.data], { type: "audio/ogg; codecs=opus" });\n      var object_url = window.URL.createObjectURL(blob);\n      audioURL.value = object_url;\n      audioBlob.value = blob;\n\n      console.log(`audio record done URL ${audioURL.value}`);\n    };\n    mediaRecorder.value = recorder;\n  });\n  console.log("media recorder create done");\n};\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onRecordSwitch")," \u7528\u6237\u70b9\u51fb\u7528\u4e8e\u5f00\u59cb/\u505c\u6b62\u5f55\u97f3\u3002\u5f53\u6ca1\u6709\u5728\u5f55\u97f3\u65f6\uff0c\u70b9\u51fb\u8be5\u6309\u952e\u4f1a\u5f00\u59cb\u5f55\u97f3\uff0c\u5e76\u91cd\u7f6e\u90e8\u5206\u72b6\u6001\u3002\u5f53\u6b63\u5728\u5f55\u97f3\u65f6\uff0c\u70b9\u51fb\u8be5\u6309\u952e\u4f1a\u505c\u6b62\u5f55\u97f3\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"const onRecordSwitch = () => {\n  if (inRecording.value) {\n    mediaRecorder.value?.stop();\n    inRecording.value = false;\n  } else {\n    audioBlob.value = null;\n    audioURL.value = null;\n    mediaRecorder.value?.start();\n    inRecording.value = true;\n  }\n  console.log(`now record state is ${mediaRecorder.value?.state}`);\n};\n")),(0,o.kt)("p",null,"\u81ea\u6b64\uff0c\u57fa\u672c\u7248\u672c\u7684\u5f55\u97f3\u529f\u80fd\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u4f46\u662f\u8fd8\u6709\u4e9b\u95ee\u9898"),(0,o.kt)("h2",{id:"edge-\u5f55\u97f3\u7ed3\u679c\u4e0d\u542b\u6709\u97f3\u9891\u957f\u5ea6\u4fe1\u606f"},"Edge: \u5f55\u97f3\u7ed3\u679c\u4e0d\u542b\u6709\u97f3\u9891\u957f\u5ea6\u4fe1\u606f"),(0,o.kt)("p",null,"\u5728\u5c06\u97f3\u9891\u4e0a\u4f20\u5230\u540e\u7aef\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u65f6\u4f1a\u53d1\u73b0\uff0c\u5f53\u7528\u6237\u4f7f\u7528 Edge \u6d4f\u89c8\u5668\u65f6\uff0c\u97f3\u9891\u6587\u4ef6\u4e0d\u5305\u542b\u957f\u5ea6\u4fe1\u606f\uff0c\u4f7f\u5f97 ffmepg \u7b49\u5de5\u5177\u65e0\u6cd5\u8fdb\u884c\u5904\u7406\u3002\u800c\u5f53\u7528\u6237\u4f7f\u7528 FireFox \u65f6\uff0c\u5374\u4e0d\u4f1a\u51fa\u73b0 Edge \u4e2d\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u9700\u8981\u5bf9\u97f3\u9891\u65f6\u957f\u8fdb\u884c\u4fee\u590d"),(0,o.kt)("p",null,"\u597d\u6d88\u606f\u662f\u5df2\u7ecf\u6709\u80fd\u591f\u4fee\u590d\u7f3a\u5c11\u97f3\u9891\u957f\u5ea6\u7684 package \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e86\uff0c\u90a3\u5bf9\u539f\u6709\u4ee3\u7801\u8fdb\u884c\u4fee\u6539\u5373\u53ef\u5bf9\u97f3\u9891\u8fdb\u884c\u957f\u5ea6\u8fdb\u884c\u4fee\u590d\uff0c\u90a3\u4e2a package \u540d\u4e3a ",(0,o.kt)("a",{parentName:"p",href:"about:blank"},(0,o.kt)("inlineCode",{parentName:"a"},"fix-webm-duration"))),(0,o.kt)("p",null,"\u9996\u5148\uff0c\u73b0\u5728\u6211\u4eec\u7684\u7ec4\u4ef6\u5c31\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u8bb0\u5f55\u5f55\u97f3\u5f00\u59cb\u65f6\u95f4\u7684\u72b6\u6001\u3002\u5e76\u4e3a",(0,o.kt)("inlineCode",{parentName:"p"},"MediaRecorder")," \u63d0\u4f9b",(0,o.kt)("inlineCode",{parentName:"p"},"onstart")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"onstop")," \u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u5e76\u4fee\u6539 ",(0,o.kt)("inlineCode",{parentName:"p"},"ondataavailable")," \u56de\u8c03\u51fd\u6570\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onstart"),"\uff1a \u8bb0\u5f55\u5f00\u59cb\u5f55\u97f3\u65f6\u95f4"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"onstop"),": \u8bb0\u5f55\u505c\u6b62\u5f55\u97f3\u65f6\u95f4\uff0c\u5e76\u5bf9\u97f3\u9891\u8fdb\u884c\u4fee\u590d\uff0c\u7136\u540e\u751f\u6210\u76f8\u5e94\u7684",(0,o.kt)("inlineCode",{parentName:"li"},"audioURL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ondataavailable"),": \u5c06\u83b7\u5f97\u7684\u97f3\u9891",(0,o.kt)("inlineCode",{parentName:"li"},"Blob")," \u653e\u5165 ",(0,o.kt)("inlineCode",{parentName:"li"},"audioBlob")," \u4e2d\uff0c\u4f9b\u540e\u7eed\u5904\u7406")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// \u5f55\u97f3\u5f00\u59cb\u65f6\u95f4\nconst startAt = ref(Date.now());\n...\n\n    recorder.onstart = () => {\n      startAt.value = Date.now();\n    };\n    recorder.onstop = async () => {\n      if (audioBlob.value != null) {\n        const now = Date.now();\n        const duration = now - startAt.value;\n        const blob = await fixWebmDuration(audioBlob.value, duration);\n        const blobOgg = new Blob([blob], { type: "audio/ogg; codecs=opus" });\n        audioURL.value = window.URL.createObjectURL(blob);\n        audioBlob.value = blobOgg;\n        console.log(`audio record done URL ${audioURL.value}`);\n      }\n    };\n    recorder.ondataavailable = (ev) => {\n      audioBlob.value = ev.data;\n    };\n')),(0,o.kt)("h2",{id:"firefox--edge-\u5f53\u4f7f\u7528-http-\u534f\u8bae\u5e76\u4e14\u670d\u52a1\u5668-ip-\u4e0d\u662f\u672c\u5730\u56de\u73af\u65f6\u5a92\u4f53\u8d44\u6e90\u4e0d\u53ef\u7528"},"FireFox & Edge \u5f53\u4f7f\u7528 HTTP \u534f\u8bae\u5e76\u4e14\u670d\u52a1\u5668 IP \u4e0d\u662f\u672c\u5730\u56de\u73af\u65f6\uff0c\u5a92\u4f53\u8d44\u6e90\u4e0d\u53ef\u7528"),(0,o.kt)("p",null,"\u5728\u8de8\u8bbe\u5907\u8c03\u8bd5\u4e2d\uff0c\u5e38\u5e38\u4f1a\u5c06\u670d\u52a1\u90e8\u7f72\u5230\u5c40\u57df\u7f51\u7684 IP \u548c\u7aef\u53e3\u4e0a\uff0c\u4fbf\u4e8e\u5176\u4ed6\u8bbe\u5907\u8fdb\u884c\u8fde\u63a5\u67e5\u770b\u6548\u679c\u3002\u4f46\u662f\u901a\u5e38\u60c5\u51b5\uff0c\u5728\u8fd9\u6837\u7684\u8c03\u8bd5\u65b9\u5f0f\u4e0b\u4e0d\u4f1a\u4f7f\u7528 SSL \u8bc1\u4e66\uff0c\u56e0\u6b64\u63d0\u4f9b\u7684\u53ea\u662f HTTP \u534f\u8bae\u7684\u670d\u52a1\u3002\u4f46\u662f\u4e0d\u8bba\u662f\u5bf9\u4e8e Firefox \u8fd8\u662f Edge , \u5f53\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u4e0d\u662f\u4f7f\u7528 HTTPS \u534f\u8bae\u5e76\u4e14 \u670d\u52a1\u5668\u4e0d\u662f\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," \uff0c \u5a92\u4f53\u8d44\u6e90\u5c06\u53d8\u5f97\u5b8c\u5168\u4e0d\u53ef\u7528\u3002 \u867d\u7136\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u8fd9\u662f\u6b63\u786e\u7684\uff0c\u4f46\u662f\u5374\u5bf9\u8c03\u8bd5\u5e26\u6765\u4e86\u4e00\u5b9a\u7684\u9ebb\u70e6\u3002"),(0,o.kt)("h3",{id:"firefox"},"FireFox"),(0,o.kt)("p",null,"\u5f53 Vue \u9879\u76ee\u5728\u5c40\u57df\u7f51\u5185\u8fdb\u884c\u76d1\u542c\u65f6\uff0c\u6b64\u65f6\u4f7f\u7528 FireFox \u8bbf\u95ee\u7f51\u7ad9\uff0c\u8bd5\u56fe\u8bf7\u6c42\u9ea6\u514b\u98ce\u6743\u9650\u65f6\uff0c\u4f1a\u53d1\u73b0\u4ee5\u4e0b\u62a5\u9519"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"Uncaught TypeError: navigator.mediaDevices is undefined\n")),(0,o.kt)("p",null,"\u8fd9\u662f\u7531\u4e8e\u4f7f\u7528\u7684\u662f HTTP \u534f\u8bae\u800c\u4e0d\u662f HTTPS\uff0c\u56e0\u6b64\uff0c\u5a92\u4f53\u8bbe\u5907\u76f8\u5173\u7684\u6743\u9650\u88ab\u706b\u72d0\u9650\u5236\u4e86\u3002"),(0,o.kt)("p",null,"\u5728\u706b\u72d0\u7684\u5730\u5740\u680f\u8f93\u5165 ",(0,o.kt)("inlineCode",{parentName:"p"},"about:config")," \u5728\u786e\u8ba4\u540e\uff0c\u8fdb\u5165\u914d\u7f6e\u754c\u9762\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u641c\u7d22\u5e76\u5c06\u4ee5\u4e0b\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a",(0,o.kt)("inlineCode",{parentName:"li"},"true"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"media.devices.insecure.enabled")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"media.getusermedia.insecure.enabled")))),(0,o.kt)("li",{parentName:"ul"},"\u641c\u7d22\u5e76\u5c06\u524d\u7aef\u7684\u670d\u52a1\u5730\u5740(\u5982 ",(0,o.kt)("inlineCode",{parentName:"li"},"http://192.168.56.1:5173/"),")\u6dfb\u52a0\u5230\u5982\u4e0b\u914d\u7f6e\u9879\u4e2d",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"security.tls.insecure_fallback_hosts"))))),(0,o.kt)("p",null,"\u6267\u884c\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u540e\uff0c\u91cd\u542f\u6d4f\u89c8\u5668\u3002\u4f1a\u53d1\u73b0\u53ef\u4ee5\u7533\u8bf7\u9ea6\u514b\u98ce\u6743\u9650\u4e86"),(0,o.kt)("h3",{id:"edge"},"Edge"),(0,o.kt)("p",null,"\u5f53 Vue \u9879\u76ee\u5728\u5c40\u57df\u7f51\u5185\u8fdb\u884c\u76d1\u542c\u65f6\uff0c\u6b64\u65f6\u4f7f\u7528 Edge(\u6216\u5176\u4ed6\u91c7\u7528 Chromium \u5185\u6838\u7684\u6d4f\u89c8\u5668) \u8bbf\u95ee\u7f51\u7ad9\uff0c\u8bd5\u56fe\u8bf7\u6c42\u9ea6\u514b\u98ce\u6743\u9650\u65f6\uff0c\u4f1a\u53d1\u73b0\u4ee5\u4e0b\u62a5\u9519"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"Uncaught TypeError: Cannot read properties of undefined (reading 'getUserMedia')\n")),(0,o.kt)("p",null,"\u539f\u56e0\u4e0e\u706b\u72d0\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u63d0\u4f9b\u89e3\u51b3\u65b9\u6cd5"),(0,o.kt)("p",null,"\u5728 Edge \u5730\u5740\u680f\u8f93\u5165 ",(0,o.kt)("inlineCode",{parentName:"p"},"edge://flags"),",\u8fdb\u5165 flags \u914d\u7f6e\u754c\u9762"),(0,o.kt)("p",null,"\u627e\u5230\u914d\u7f6e\u9879 ",(0,o.kt)("inlineCode",{parentName:"p"},"Insecure origins treated as secure")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5c06\u524d\u7aef\u7684\u670d\u52a1\u5730\u5740(\u5982 ",(0,o.kt)("inlineCode",{parentName:"li"},"http://192.168.56.1:5173/"),")\u6dfb\u52a0\u5230\u6587\u672c\u6846\u4e2d"),(0,o.kt)("li",{parentName:"ul"},"\u5c06\u8fd9\u4e2a\u914d\u7f6e\u9879\u4ece ",(0,o.kt)("inlineCode",{parentName:"li"},"disable")," \u5207\u6362\u4e3a ",(0,o.kt)("inlineCode",{parentName:"li"},"enable"))),(0,o.kt)("p",null,"\u5b8c\u6210\u540e\uff0cEdge \u4f1a\u63d0\u9192\u91cd\u542f\u6d4f\u89c8\u5668\u3002\u91cd\u542f\u6d4f\u89c8\u5668\u540e\uff0c\u5c31\u80fd\u7533\u8bf7\u9ea6\u514b\u98ce\u6743\u9650\u4e86"),(0,o.kt)("h2",{id:"\u5b8c\u6574\u4ee3\u7801"},"\u5b8c\u6574\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<template>\n  <div>\n    <v-container justify="center">\n      <v-col sm="6" md="4" cols="auto">\n        <v-btn @click="onQueryPermission">Request Audio Permission</v-btn>\n      </v-col>\n      <v-col sm="6" md="4" cols="auto">\n        <v-btn :disabled="mediaRecorder == null" @click="onRecordSwitch"\n          >{{ inRecording ? "Stop" : "Start" }} Audio Recording</v-btn\n        >\n      </v-col>\n      <v-col sm="6" md="4" cols="auto">\n        <v-btn :disabled="audioURL == null">Upload</v-btn>\n      </v-col>\n      <audio v-if="audioURL != null" controls :src="audioURL"></audio>\n    </v-container>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport fixWebmDuration from "fix-webm-duration";\nimport { ref } from "vue";\n\n// \u5728\u672a\u53d6\u5f97\u7528\u6237\u6388\u6743\uff0c\u6ca1\u6709\u76f8\u5e94\u7684\u5f55\u97f3\u5668\u5b9e\u4f8b\u5b58\u5728\nconst mediaRecorder = ref<null | MediaRecorder>(null);\n// \u5f53\u524d\u662f\u5426\u6b63\u5728\u8fdb\u884c\u5f55\u97f3\nconst inRecording = ref(false);\n// \u5f55\u97f3\u7ed3\u679c\u7684URL\nconst audioURL = ref<null | string>(null);\n// \u5f55\u97f3\u7ed3\u679c\u7684\u539f\u59cbBlob\nconst audioBlob = ref<null | Blob>(null);\n// \u5f55\u97f3\u5f00\u59cb\u65f6\u95f4\nconst startAt = ref(Date.now());\n\nconst onQueryPermission = () => {\n  navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {\n    let recorder = new MediaRecorder(stream);\n\n    recorder.onstart = () => {\n      startAt.value = Date.now();\n    };\n    recorder.onstop = async () => {\n      if (audioBlob.value != null) {\n        const now = Date.now();\n        const duration = now - startAt.value;\n        const blob = await fixWebmDuration(audioBlob.value, duration);\n        const blobOgg = new Blob([blob], { type: "audio/ogg; codecs=opus" });\n        audioURL.value = window.URL.createObjectURL(blob);\n        audioBlob.value = blobOgg;\n        console.log(`audio record done URL ${audioURL.value}`);\n      }\n    };\n\n    recorder.ondataavailable = (ev) => {\n      audioBlob.value = ev.data;\n    };\n    mediaRecorder.value = recorder;\n  });\n  console.log("media recorder create done");\n};\n\nconst onRecordSwitch = () => {\n  if (inRecording.value) {\n    mediaRecorder.value?.stop();\n    inRecording.value = false;\n  } else {\n    audioBlob.value = null;\n    audioURL.value = null;\n    mediaRecorder.value?.start();\n    inRecording.value = true;\n  }\n  console.log(`now record state is ${mediaRecorder.value?.state}`);\n};\n<\/script>\n')))}s.isMDXComponent=!0}}]);